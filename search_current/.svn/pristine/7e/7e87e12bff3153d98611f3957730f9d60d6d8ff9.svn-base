<%@ page language="java" trimDirectiveWhitespaces="true" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="display" uri="http://displaytag.sf.net/el"%>
<%@ page import="vn.onepay.common.SharedConstants, vn.onepay.account.model.Account, java.lang.String"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<jsp:include page="head.jsp"></jsp:include>
<link href="${pageContext.request.contextPath }/css/personal.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="<%=request.getContextPath() %>/css/jquery.multiselect.css" />
<link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/css/jquery-ui.min.css" />
<script type="text/javascript" src="<%=request.getContextPath() %>/js/jquery-ui.min.js"></script>
<script type="text/javascript" src="<%=request.getContextPath() %>/js/jquery.multiselect.js"></script>

<script src="<%=request.getContextPath()%>/js/numeral.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="<%=request.getContextPath() %>/css/jquery.datetimepicker.css"/>
<script src="<%=request.getContextPath() %>/js/jquery.datetimepicker.js"></script>

<jsp:include page="card-charging.css.jsp" />

<style>
    .fieldset_filter {border: solid 1px #ccc;margin-left:20px; margin-bottom:20px; width: auto;}
</style>

<script type="text/javascript">
/* var th = new Date();
alert(th.toString('dd/MM/yyyy')); */

</script>

</head>
<%
    Account account = (Account) request.getSession().getAttribute(SharedConstants.ACCOUNT_LOGINED);
    boolean isAdmin = account.isAdmin();
    boolean mbiz =  SharedConstants.MBIZ && isAdmin;
    request.setAttribute("MBIZ", mbiz);
    
    request.setAttribute("isOperator", account.isOperator());
    request.setAttribute("isBizSupporter", account.isBizSupporter());
    request.setAttribute("isCustomerCare", account.isCustomerCare());
    
%>
<body>
    <!-- 1PAY WEB -->
    <div id="wrapper">
        <!-- Web Top -->
        <div id="w_top">
            <div class="layout_1000">
                <!-- Header -->
                <%request.setAttribute("menuTrangChu", true); %>
                <jsp:include page="header.jsp"></jsp:include>
                <!-- / Header -->

                <!-- Body -->
                <div id="w_body">
                    <div class="row_sub">
                        <!-- Persanal Bar -->
                        <jsp:include page="include_personal_bar.jsp" />
                        <!-- Left Menu -->
                        <%request.setAttribute("cardReportElastic", true);%>
                        <jsp:include page="include_personal_menu.jsp" />
                        
                        <div class="right_content">
                            <h1 class="srv_title">Cấu hình thẻ lỗi</h1>
                            <a href="#add_record_popup" rel="leanmodal" class="add_record_popup" style="margin-right: 5px;"><span>Thêm mới</span></a>
                            
                            <c:if test="${model.total > 0}">
                                 <span class="pagebanner"> ${model.total} kết quả tìm thấy, hiển thị từ ${model.offset + 1  } tới ${(model.offset + model.pagesize) > model.total ? model.total : (model.offset + model.pagesize) }. 
                                     &nbsp(Thời gian tìm kiếm ${model.timeHandleTotal /1000.0} giây)
                                 </span>
                             </c:if>
                             <br/>
                             
                            <display:table name="model.list" id="list"
                                requestURI="card-error-config.html" partialList="true" size="model.total" pagesize="${model.pagesize}"
                                style="width:100%;cellspacing:0;cellpadding:0;border: 1px solid #CCC;table-layout:fixed;" 
                                sort="list"
                                >
                                <%@ include file="display_table.jsp" %>
                                <display:column title="Stt" headerClass="transhead fit_to_content" class="transdata" style="text-align:right;border: 1px solid #CCC;">
                                    <span id="row${list.id}" class="rowid">
                                        <c:out value="${model.offset + list_rowNum }" />
                                    </span>
                                </display:column>
                                <display:column title="Tiêu đề" headerClass="transhead" class="transdata" property="title" style="border: 1px solid #CCC;" />
                                <display:column title="Telco" headerClass="transhead" class="transdata" property="telco" style="border: 1px solid #CCC;" />
                                
                                <display:column title="Thời gian từ" headerClass="transhead" class="transdata" property="from_time" style="border: 1px solid #CCC; text-align:center;" format="{0,date,dd/MM/yyyy HH:mm:ss}" />
                                <display:column title="Thời gian đến" headerClass="transhead" class="transdata" property="end_time" style="border: 1px solid #CCC; text-align:center;" format="{0,date,dd/MM/yyyy HH:mm:ss}" />
                                
                                <display:column title="Ngày tạo" headerClass="transhead" class="transdata" property="created_time" style="border: 1px solid #CCC; text-align:center;" format="{0,date,dd/MM/yyyy HH:mm:ss}" />
                                
                                <display:column title="Hành động" headerClass="transhead width70" class="transdata" style="border: 1px solid #CCC; text-align:center;" >
                                    <a href="#">
                                        <img src="<%=request.getContextPath() %>/images/editComparison.png" alt="" title="Sửa cấu hình"/>
                                    </a>
                                    <a href="#">
                                        <img src="<%=request.getContextPath() %>/images/cross.png" alt="" title="Xóa cấu hình"/>
                                    </a>
                                
                                </display:column>
                            </display:table>
                            
                            <script type="text/javascript">
                            
                              $(document).ready(function(){
                            	$('.add_record_popup').live('click', function(){
                            		$('#add_record_popup form[name=add_edit] input[name=action]').val('ADD_EDIT');
                            		
                            	});
                            	
                           	    $('#add_record_popup form[name=add_edit]').submit(function(){
                           	    	
                           	    	if(!confirm('Bạn có chắc chắn?'))
                           	    		return false;
                           	    	
                           	    	$.ajax({
                                        type : "post",
                                        url : $(this).attr('action'),
                                        data : $(this).serializeArray(),
                                        success : function(data){
                                            alert(data);
                                            if(data.indexOf('thành công') != -1)
                                                location.reload();
                                        }
                           	    	
                                    });
                           	    	return false;
                           	    	
                           	    });
                              });
                            </script>
                            <!-- add & edit popup -->
                            <div id="add_record_popup">
                                <form action="card-error-config-ajax.html" method="post" name="add_edit">
                                    <input type="hidden" name="action" value="ADD_EDIT"/>
	                                <h2 class=""><span class="update_status">Cấu hình thẻ lỗi</span></h2>
	                                <div class="item">
					                    <label>Tiêu đề: </label>
					                    <input type="text" name="title" />
					                </div>
					                <div class="item">
					                    <label>Telco: </label>
					                    <input type="text" name="telco" />
					                </div>
					                <div class="item">
					                    <label>Thời gian bắt đầu: </label>
					                    <input type="text" id="from_time" name="from_time" />
					                </div>
					                <div class="item">
					                    <label>Thời gian kết thúc: </label>
					                    <input type="text" id="end_time" name="end_time" />
					                </div>
					                
					                <div class="decision" >
			                          <input name="submit_record" class="btn_greensmall" type="submit" value="Tạo mới" />
			                          <input name="cancel_record" class="btn_graysmall modal_close" type="reset" value="Bỏ qua" name="reset" />
		                            </div>
	                            </form>
                            </div>
                            <script type="text/javascript">
							  $(function(){
							        $( "#end_time" ).datetimepicker({
							                format: 'd/m/Y H:i',
							                lang: 'vi',
							                minDate:0,
							                style: 'z-index:99999',
							        });
							        
							        $( "#from_time" ).datetimepicker({
	                                        format: 'd/m/Y H:i',
	                                        lang: 'vi',
	                                        minDate:0,
	                                        style: 'z-index:99999',
	                                });
							    });
							</script>
                        </div>
                    </div>
                </div>
                <!-- / Body -->
            </div>
        </div>
        <!-- / Web Top -->

        <!-- Web Foot -->
        <jsp:include page="footer.jsp"></jsp:include>
        <!-- / Web Foot -->
    </div>
    <!-- / 1PAY WEB -->

</body>
</html>
